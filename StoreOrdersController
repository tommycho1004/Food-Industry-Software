package com.example.demo;

import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.scene.control.*;

import java.text.DecimalFormat;

public class StoreOrdersController {

    StoreOrders storeOrderList = new StoreOrders();

    public StoreOrders getStoreOrderList() {
        return storeOrderList;
    }

    private ObservableList<String> items = FXCollections.observableArrayList();

    @FXML
    private Button cancelOrderButton;

    @FXML
    private Button exportOrders;

    @FXML
    private TextField orderTotal;

    @FXML
    private ComboBox<String> phoneMenu;

    @FXML
    private ListView<String> storeOrdersList;

    @FXML
    private Button updateButton;


    @FXML
    void cancelOrderButtonClick(ActionEvent event) {
        String selected = phoneMenu.getSelectionModel().getSelectedItem();
        try{
            storeOrderList.removeOrder(storeOrderList.findOrder(selected));
            items.clear();
            for (int i = 0; i < storeOrderList.getOrders().size(); i++){
                items.add(storeOrderList.getOrders().get(i).getPhoneNumber());
            }
            phoneMenu.setItems(items);
        }
        catch (Exception e){
            storeOrdersList.getItems().add("");
        }

    }

    @FXML
    void exportOrdersClick(ActionEvent event) {
        storeOrderList.export();
    }

    @FXML
    void selectPhoneNumber(ActionEvent event) {
        storeOrdersList.getItems().clear();
        DecimalFormat dec = new DecimalFormat("#0.00");
        dec.setGroupingUsed(true);
        dec.setGroupingSize(3);
        try{
            String selected = phoneMenu.getSelectionModel().getSelectedItem();
            for (int i = 0; i < storeOrderList.findOrder(selected).getPizzas().size(); i++){
                storeOrdersList.getItems().add(storeOrderList.findOrder(selected).getPizzas().get(i).printPizza());
            }
            orderTotal.clear();
            orderTotal.appendText(dec.format(storeOrderList.findOrder(selected).getGrandTotal()));
        }
        catch (Exception e){
            storeOrdersList.getItems().add("");
        }


    }

    @FXML
    void updateOrders(ActionEvent event) {
        Order testOrder = new Order();
        Order testOrder2 = new Order();
        testOrder2.setPhoneNumber("2016003382");
        testOrder.setPhoneNumber("7323369471");
        testOrder.addPizza(PizzaMaker.createPizza("Pepperoni"));
        testOrder.addPizza(PizzaMaker.createPizza("Deluxe"));
        storeOrderList.addOrder(testOrder);
        testOrder2.addPizza(PizzaMaker.createPizza("Hawaiian"));
        storeOrderList.addOrder(testOrder2);
        items.clear();
        for (int i = 0; i < storeOrderList.getOrders().size(); i++){
            items.add(storeOrderList.getOrders().get(i).getPhoneNumber());
        }
        phoneMenu.setItems(items);
    }
}
